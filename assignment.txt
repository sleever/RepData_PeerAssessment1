require(ggplot2)
require(sqldf)
require(dplyr)

## data
activities <- read.csv("Programming assignments\\reproducible_research_1\\activity.csv");

## First plot:

dailyTotalSteps <- sqldf("SELECT date, sum(steps) as totalSteps, avg(steps) as avgSteps from activities where steps != 'NA' group by date")

hist(dailyTotalSteps$totalSteps, breaks = 30, xlab = "Number of steps", main = "Total number of steps by day")
abline(v = mean(dailyTotalSteps$totalSteps), col = "blue", lwd = 1)

## Second plot:

dailyAverageSteps <- sqldf("SELECT interval, avg(steps) as avgSteps from activities where steps != 'NA' group by interval")

qplot(interval, avgSteps, data=dailyAverageSteps, geom="line", main="Time series of average steps per activity", xlab = "Interval", ylab = "Average number of steps")

## Cleaning the data

cleanedActivities <- activities
for (row in 1:nrow(cleanedActivities)) {
	if (is.na(cleanedActivities[row,"steps"])) {
		cleanedActivities[row,"steps"] <- dailyAverageSteps$avgSteps[dailyAverageSteps$interval == cleanedActivities[row,"interval"]]
	}else{
		cleanedActivities[row,"steps"] <- cleanedActivities[row,"steps"]
	}
}

## Total number of steps each day with cleaned up/enriched data, create a histogram

dailyTotalCleanedSteps <- sqldf("SELECT date, sum(steps) as totalSteps, avg(steps) as avgSteps from cleanedActivities where steps != 'NA' group by date")

hist(dailyTotalCleanedSteps$totalSteps, breaks = 30, xlab = "Number of steps", main = "Total number of steps by day")
abline(v = mean(dailyTotalCleanedSteps$totalSteps), col = "blue", lwd = 1)

## Compare weekdays to weekend

cleanedActivities$weekday <- as.factor(ifelse(weekdays(as.Date(as.character(cleanedActivities$date))) %in% 
                                    c("Saturday","Sunday"),"weekend", "weekday"))

weekend <- sqldf("SELECT interval, avg(steps) as avgSteps, weekday
    FROM cleanedActivities
    WHERE weekday = 'weekend'
      GROUP BY weekday, interval
      ORDER BY interval")
      
weekday <- sqldf("SELECT interval, avg(steps) as avgSteps, weekday
    FROM cleanedActivities
    WHERE weekday = 'weekday'
      GROUP BY weekday, interval
      ORDER BY interval")
      
plot1 <- qplot(interval, avgSteps, data=weekend, geom="line", main="Time series of average steps per activity during weekends", xlab = "Interval", ylab = "Average number of steps")

plot2 <- qplot(interval, avgSteps, data=weekday, geom="line", main="Time series of average steps per activity during weekdays", xlab = "Interval", ylab = "Average number of steps")

grid.arrange(plot1, plot2)